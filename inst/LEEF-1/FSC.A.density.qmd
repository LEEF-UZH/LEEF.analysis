---
title: "FSC.A Densities"
output:
  html_document:
    dev: png
    fig_width: 10
    fig_height: 12
    toc: true
    toc_float: true
    toc_collapsed: true
    code_folding: hide  
    embed-resources: true
---



```{r}
library(dplyr)
library(ggplot2)
trait_files <- list.files(
  "~/RRD.Reclassification_final/flowcytometer_traits/",
  full.names = TRUE
)

dens <- lapply(
  trait_files,
  function(fn){
    traits <- readRDS(fn)
    
    result <- list()
    result$timestamp <- (fn |> basename() |> strsplit(split = "\\."))[[1]][[2]] |> as.numeric()
    result$density <- density(traits$FSC.A, bw = 0.00001, na.rm = TRUE)
    q <- quantile(traits$FSC.A, probs = c(0.025, 0.5, 0.975), na.rm = TRUE)
    result$min <- q[[1]]
    result$median <- q[[2]]
    result$max <- q[[3]]
    return(result)
  }
)
saveRDS(dens, "dens.rds")

q <- sapply(
  dens,
  function(x){
    quantile(
      x$density[[1]], 
      probs = c(0.025, 0.5, 0.975)
    )
  }
)


timestamps <- sapply(dens, function(x){x$timestamp})
plot(
  x = 1:length(timestamps),
  y = q[2,],
  xlim = c(0, length(timestamps)),
  ylim = range(q),
  xlab = "measurements",
  ylab = "0.025 - median - 0.975 - FSC.A"
)
lines(
  x = 1:length(timestamps),
  y = q[1,]
)
lines(
  x = 1:length(timestamps),
  y = q[3,]
)

plot(dens[[1]]$density, ylim = c(0, 1000))
lines(dens[[1]]$density$x, dens[[50]]$density$y + 200)
lines(dens[[1]]$density$x, dens[[100]]$density$y + 400)
lines(dens[[1]]$density$x, dens[[123]]$density$y + 450)

```

