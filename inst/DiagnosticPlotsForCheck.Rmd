---
title: "Diagnostic plots for the RRD ``r params$db``"
author: "Rainer M Krug"
date: "`r Sys.time()`"
output:
  html_document:
    dev: png
    fig_width: 10
    fig_height: 12
    toc: true
    toc_float: true
    toc_collapsed: true
  pdf_document:
    dev: pdf
    fig_width: 10
    fig_height: 12
  word_document: 
    dev: png
    fig_width: 10
    fig_height: 12
params:
  db: ~/Desktop/LEEF.RRD.sqlite
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(LEEF.analysis)
```
## Invocation from commandline
The report can be generated from the command line by using

```{bash info_invocation, eval = FALSE}
Rscript -e '
db <- "~/Desktop/LEEF.RRD.sqlite";
Rscript -e "library(LEEF.analysis); report_diagnostic(db);"
'
```

\pagebreak

## Check Bottles per Measurement per Timestep

This plot shows, if a `bottle` is present for the `measurement` for the timesteamps analysed. Each `measurement` is a panes. Missing dots indicate missing datapoints for the `bottle` at the `measurement` for the `timestamp`.

```{r bottles_per_timestamp}
plot_bottles_per_timestamp(params$db)
```

\pagebreak

## Number of Species per timestamp

This plot shows the 
```{r no_species_per_measurement, fig.height = 8}
plot_no_species_per_bottle_per_timestamp(params$db)
```

\pagebreak

## Species per timestamp and measurement
Measurements are colour coded and in the order as in the legend on the right.

```{r species_per_timestamp_per_measure, fig.height = 8}
plot_species_per_timestamp_per_measure(params$db)
```

## Density of Species per bottle as measured by measurement over time

### bemovi_mag_16
```{r dens_species_16, fig.height = 16}
plot_density_species_per_bottle_per_timestamp("~/Desktop/LEEF.RRD.sqlite", "bemovi_mag_16")
```


### bemovi_mag_25
```{r dens_species_25, fig.height = 16}
plot_density_species_per_bottle_per_timestamp("~/Desktop/LEEF.RRD.sqlite", "bemovi_mag_25")
```

### bemovi_mag_25_cropped
```{r dens_species_25c, fig.height = 16}
plot_density_species_per_bottle_per_timestamp("~/Desktop/LEEF.RRD.sqlite", "bemovi_mag_25_cropped")
```

### flowcam
```{r dens_species_fca, fig.height = 16}
plot_density_species_per_bottle_per_timestamp("~/Desktop/LEEF.RRD.sqlite", "flowcam")
```

### flowcytometer
```{r dens_species_fcy, fig.height = 16}
plot_density_species_per_bottle_per_timestamp("~/Desktop/LEEF.RRD.sqlite", "flowcytometer")
```

### manualcount
```{r dens_species_mc, fig.height = 16}
plot_density_species_per_bottle_per_timestamp("~/Desktop/LEEF.RRD.sqlite", "manualcount")
```


### Interactive
```{r eruptions, echo=FALSE}
shiny::inputPanel(
  shiny::selectInput("measurement", label = "Measurement:",
              choices = c(
                "bemovi_mag_16", "bemovi_mag_25", "bemovi_mag_25_cropped", 
                "flowcam", 
                "flowcytometer", 
                "manualcount",
                "all"
              ), selected = 1),
  
  shiny::sliderInput("bottle", label = "Bottle:",
              min = 1, max = 32, value = 1, step = 1)
)

shiny::renderPlot(
  LEEF.analysis::plot_density_species_per_bottle_per_timestamp("~/Desktop/LEEF.RRD.sqlite", input$measurement),
  height = 1600
)
```

